<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>每日多语言新闻</title>
    <style>
      /* === Global === */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
  margin: 0;
  padding: 2rem;
  color: #333;
  line-height: 1.7;
}

h1, h2 {
  color: #2c3e50;
  margin-top: 0;
}

/* === Cards === */
.card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

/* === Vocabulary === */
.vocab-card {
  border-left: 4px solid #0077ff;
  padding-left: 1rem;
  margin-bottom: 0.8rem;
}

/* === Responsive === */
@media (max-width: 600px) {
  body { padding: 1rem; }
}
    </style>
</head>
<body>
   <body>
  <h1>📰 每日多语言新闻</h1>

  <div class="card">
    <h2>🇨🇳 中文原文</h2>
    <p id="origin">正在加载…</p>
  </div>

  <div class="card">
    <h2>🇬🇧 英语改写（300±20 字）</h2>
    <p id="en">正在加载…</p>
  </div>

  <div class="card">
    <h2>🌏 日语 / 法语 / 德语翻译</h2>
    <p><strong>🇯🇵 日语：</strong><span id="ja">正在加载…</span></p>
    <p><strong>🇫🇷 法语：</strong><span id="fr">正在加载…</span></p>
    <p><strong>🇩🇪 德语：</strong><span id="de">正在加载…</span></p>
  </div>

  <div class="card">
    <h2>🔑 5 Key Words</h2>
    <div id="vocab">正在加载…</div>
  </div>

  <div class="card">
    <h2>📚 Mini Grammar</h2>
    <p><strong>🇯🇵 Japanese：</strong><span id="grammar-ja">正在加载…</span></p>
    <p><strong>🇫🇷 French：</strong><span id="grammar-fr">正在加载…</span></p>
    <p><strong>🇩🇪 German：</strong><span id="grammar-de">正在加载…</span></p>
  </div>

  <!-- keep the same <script> you already have -->
</body>

<script type="module">
import { GoogleGenerativeAI } from "https://esm.sh/@google/generative-ai";
const API_KEY = "AIzaSyCQArQERu9Nk-E9hnKxOB6F3B285eJu9OI";          // ← 记得换成真实 key
const genAI = new GoogleGenerativeAI(API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash-latest" });

// 1. 抓取 China Daily 第一条新闻
async function fetchNews() {
  // 用国内可访问的 CORS 代理 + RSS 地址
  const rssUrl = "https://www.chinadaily.com.cn/rss/world.xml";
  const proxy  = `https://api.allorigins.win/raw?url=${encodeURIComponent(rssUrl)}`;
  const xml    = await fetch(proxy).then(r => r.text());

  // 2. 简单解析：取第一条 <title> 和 <description>
  const title = xml.match(/<title>(.*?)<\/title>/i)?.[1] || "";
  const desc  = xml.match(/<description>(.*?)<\/description>/i)?.[1] || "";
  return title + " " + desc;
}

// 3. 主流程
window.addEventListener('DOMContentLoaded', async () => {
  try {
    const news = await fetchNews();
    document.getElementById("origin").innerText = news;

    // 英文改写
    const en = await model.generateContent(`将下面中文新闻改写成英文，300±20字：\n${news}`);
    document.getElementById("en").innerText = en.response.text();

    // 三语翻译
    const [ja, fr, de] = await Promise.all([
      model.generateContent(`翻译成日语：\n${news}`),
      model.generateContent(`翻译成法语：\n${news}`),
      model.generateContent(`翻译成德语：\n${news}`)
    ]);
    document.getElementById("ja").innerText = ja.response.text();
    document.getElementById("fr").innerText = fr.response.text();
    document.getElementById("de").innerText = de.response.text();

    // 词汇卡片（同上逻辑）
    const vocabRaw = (await model.generateContent(
      `从上面英文改写中，挑出5个对日语/法语/德语初学者较难的核心词汇，格式：原词|音标|英/日/法/德释义|例句`
    )).response.text();
    const lines = vocabRaw.trim().split('\n');
    let html = '';
    lines.forEach(line => {
      const [word, ipa, ...rest] = line.split('|');
      html += `<div class="vocab-card">${word} ${ipa}<br>${rest.join(' / ')}</div>`;
    });
    document.getElementById("vocab").innerHTML = html;

    // 迷你语法
    const grammarPrompt = (lang) => `用中文指出上面英文句子里最简单的${lang}语法现象`;
    document.getElementById("grammar-ja").innerText = (await model.generateContent(grammarPrompt("日语"))).response.text();
    document.getElementById("grammar-fr").innerText = (await model.generateContent(grammarPrompt("法语"))).response.text();
    document.getElementById("grammar-de").innerText = (await model.generateContent(grammarPrompt("德语"))).response.text();

  } catch (err) {
    document.getElementById("origin").innerText = "网络或API出错：" + err.message;
  }
});
</script>
</body>
</html>
