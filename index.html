<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ¯æ—¥å¤šè¯­è¨€æ–°é—»</title>
    <style>
      /* === Global === */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
  margin: 0;
  padding: 2rem;
  color: #333;
  line-height: 1.7;
}

h1, h2 {
  color: #2c3e50;
  margin-top: 0;
}

/* === Cards === */
.card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

/* === Vocabulary === */
.vocab-card {
  border-left: 4px solid #0077ff;
  padding-left: 1rem;
  margin-bottom: 0.8rem;
}
.lang-box {
  flex: 1 1 30%;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 0.8rem;
  min-width: 200px;
}
/* === Responsive === */
@media (max-width: 600px) {
  body { padding: 1rem; }
}
    </style>
</head>
<body>
   <body>
  <h1>ğŸ“° æ¯æ—¥å¤šè¯­è¨€æ–°é—»</h1>

  <div class="card">
    <h2>ğŸ‡¨ğŸ‡³ ä¸­æ–‡åŸæ–‡</h2>
    <p id="origin">æ­£åœ¨åŠ è½½â€¦</p>
  </div>

  <div class="card">
    <h2>ğŸ‡¬ğŸ‡§ è‹±è¯­æ”¹å†™ï¼ˆ300Â±20 å­—ï¼‰</h2>
    <p id="en">æ­£åœ¨åŠ è½½â€¦</p>
  </div>

  <div class="card">
    <h2>ğŸŒ æ—¥è¯­ / æ³•è¯­ / å¾·è¯­ç¿»è¯‘</h2>
    <p><strong>ğŸ‡¯ğŸ‡µ æ—¥è¯­ï¼š</strong><span id="ja">æ­£åœ¨åŠ è½½â€¦</span></p>
    <p><strong>ğŸ‡«ğŸ‡· æ³•è¯­ï¼š</strong><span id="fr">æ­£åœ¨åŠ è½½â€¦</span></p>
    <p><strong>ğŸ‡©ğŸ‡ª å¾·è¯­ï¼š</strong><span id="de">æ­£åœ¨åŠ è½½â€¦</span></p>
  </div>

  <div class="card">
    <h2>ğŸ”‘ 5 Key Words</h2>
    <div id="vocab">æ­£åœ¨åŠ è½½â€¦</div>
  </div>

  <div class="card">
    <h2>ğŸ“š Mini Grammar</h2>
    <p><strong>ğŸ‡¯ğŸ‡µ Japaneseï¼š</strong><span id="grammar-ja">æ­£åœ¨åŠ è½½â€¦</span></p>
    <p><strong>ğŸ‡«ğŸ‡· Frenchï¼š</strong><span id="grammar-fr">æ­£åœ¨åŠ è½½â€¦</span></p>
    <p><strong>ğŸ‡©ğŸ‡ª Germanï¼š</strong><span id="grammar-de">æ­£åœ¨åŠ è½½â€¦</span></p>
  </div>
       
  <div class="card">
  <h2>ğŸŒ ä¸‰è¯­ç¿»è¯‘</h2>
  <div style="display:flex; gap:1rem; flex-wrap:wrap;">
    <div class="lang-box">ğŸ‡¯ğŸ‡µ æ—¥è¯­<br><span id="ja">æ­£åœ¨åŠ è½½â€¦</span></div>
    <div class="lang-box">ğŸ‡«ğŸ‡· æ³•è¯­<br><span id="fr">æ­£åœ¨åŠ è½½â€¦</span></div>
    <div class="lang-box">ğŸ‡©ğŸ‡ª å¾·è¯­<br><span id="de">æ­£åœ¨åŠ è½½â€¦</span></div>
  </div>
</div>

  <!-- keep the same <script> you already have -->
</body>

<script type="module">
import { GoogleGenerativeAI } from "https://esm.sh/@google/generative-ai";
const API_KEY = "AIzaSyCQArQERu9Nk-E9hnKxOB6F3B285eJu9OI";          // â† è®°å¾—æ¢æˆçœŸå® key
const genAI = new GoogleGenerativeAI(API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash-latest" });

async function fetchNews() {
  const rssUrl = "http://www.xinhuanet.com/english/rss/worldrss.xml";
  const proxy  = `https://api.allorigins.win/raw?url=${encodeURIComponent(rssUrl)}`;
  const xml    = await fetch(proxy).then(r => r.text());

  // 1. å–ç¬¬ä¸€æ¡ <item> çš„ title & description
  const titleMatch = xml.match(/<item>[\s\S]*?<title>(.*?)<\/title>/i);
  const descMatch  = xml.match(/<item>[\s\S]*?<description>(.*?)<\/description>/i);
  let title = titleMatch ? titleMatch[1].trim() : "";
  let desc  = descMatch  ? descMatch[1].trim()  : "";

  // 2. å»æ‰ CDATA å’Œ HTML æ ‡ç­¾
  [title, desc] = [title, desc].map(t => t
      .replace(/<!\[CDATA\[/g, "")
      .replace(/\]\]>/g, "")
      .replace(/<[^>]*>/g, "")
  );
  return title + " " + desc;
}

// ğŸ”´ é«˜äº®è‹±æ–‡æ”¹å†™ + è¯æ±‡/è¯­æ³•
async function run() {
  try {
    const news = await fetchNews();
    document.getElementById("origin").innerText = news;

    // 1ï¸âƒ£ è‹±æ–‡æ”¹å†™ï¼ˆè¦æ±‚ AI é«˜äº®ï¼‰
    const enPrompt = `
æŠŠä¸‹é¢ä¸­æ–‡æ–°é—»æ”¹å†™æˆ 300Â±20 å­—çš„è‹±æ–‡ï¼Œå¹¶åœ¨å…¶ä¸­ **5 ä¸ªé‡éš¾ç‚¹è¯æ±‡** å‰ååŠ æ ¼å¼ï¼š
**è¯æ±‡**(ä¸­æ–‡é‡Šä¹‰)
ä¾‹å¦‚ï¼š**escalated**(å‡çº§)
åŸæ–‡ï¼š${news}
`;
    const enText = (await model.generateContent(enPrompt)).response.text();
    // æ¸²æŸ“æ—¶æŠŠ **è¯**(é‡Šä¹‰) æ¢æˆ <b style="color:red">è¯</b><span style="color:gray">é‡Šä¹‰</span>
    const highlighted = enText.replace(
      /\*\*(.+?)\)\(([^)]+)\)\*\*/g,
      '<b style="color:red">$1</b><span style="color:gray;font-size:0.9em">($2)</span>'
    );
    document.getElementById("en").innerHTML = highlighted;

    // 2ï¸âƒ£ ä¸‰è¯­ç¿»è¯‘
    const [ja, fr, de] = await Promise.all([
      model.generateContent(`ç¿»è¯‘æˆæ—¥è¯­ï¼š\n${news}`),
      model.generateContent(`ç¿»è¯‘æˆæ³•è¯­ï¼š\n${news}`),
      model.generateContent(`ç¿»è¯‘æˆå¾·è¯­ï¼š\n${news}`)
    ]);
    ["ja", "fr", "de"].forEach((id, i) => {
      document.getElementById(id).innerText = [ja, fr, de][i].response.text();
    });

    // 3ï¸âƒ£ 5 Key Words
    const vocabPrompt = `
ä»ä¸‹é¢è‹±æ–‡æ”¹å†™ä¸­ï¼ŒæŒ‘å‡º 5 ä¸ªå¯¹æ—¥/æ³•/å¾·åˆå­¦è€…è¾ƒéš¾çš„è¯æ±‡ï¼Œæ ¼å¼ï¼š
è¯æ±‡|éŸ³æ ‡|è‹±/æ—¥/æ³•/å¾·é‡Šä¹‰|ä¾‹å¥
è‹±æ–‡æ”¹å†™ï¼š${enText}
`;
    const vocabRaw = (await model.generateContent(vocabPrompt)).response.text();
    let vocabHTML = "";
    vocabRaw.trim().split('\n').forEach(line => {
      const [w, ipa, ...rest] = line.split('|');
      vocabHTML += `<div class="vocab-card">
        <b style="color:red">${w}</b> ${ipa}<br>${rest.join(' / ')}
      </div>`;
    });
    document.getElementById("vocab").innerHTML = vocabHTML || "æš‚æ— è¯æ±‡";

    // 4ï¸âƒ£ Mini Grammar
    const grammarPrompt = (lang) =>
      `ç”¨ä¸­æ–‡æŒ‡å‡ºä¸‹é¢è‹±æ–‡å¥å­é‡Œæœ€ç®€å•çš„${lang}è¯­æ³•ç°è±¡ï¼Œ30å­—ä»¥å†…ï¼š\n${enText}`;
    ["ja", "fr", "de"].forEach(async (lang, idx) => {
      const res = await model.generateContent(grammarPrompt(lang));
      document.getElementById(`grammar-${lang}`).innerText = res.response.text();
    });

  } catch (err) {
    document.getElementById("origin").innerText = "ç½‘ç»œæˆ–APIå‡ºé”™ï¼š" + err.message;
  }
}
window.addEventListener('DOMContentLoaded', run);
</script>
</body>
</html>
